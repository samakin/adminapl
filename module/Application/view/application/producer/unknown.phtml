<?php
$this->headTitle('Неизвестные производители');

$this->mainMenu()->setActiveItemId('rb');

$this->pageBreadcrumbs()->setItems([
            'Главная'=>$this->url('home'),
            'Производители'=>$this->url('producer'),
            'Неизвестные производители'=>$this->url('producer', ['action'=>'unknown'])
            ]);

$this->headLink()
    ->appendStylesheet('https://cdnjs.cloudflare.com/ajax/libs/typeahead.js-bootstrap-css/1.2.1/typeaheadjs.min.css')
    ->appendStylesheet('https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css');

$this->headScript()
    ->appendFile('https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js')
    ->prependFile($this->basePath('/js/typeahead.js/typeahead.jquery.min.js'))
            ;
        
?>

<h1>Неизвестные производители</h1>
<form method="GET">
    <div class="row">
        <div class="col-lg-7">
            <div class="input-group">
                <span class="input-group-btn">
                    <a class="btn btn-default <?= ($ua ? 'active':'')?>" href="
                        <?= $this->url('producer', ['action'=>'unknown'], ['query' => ['ua' => 1]]); ?>">
                        Не привязанные
                    </a>
                    <a class="btn btn-default <?= ($ua ? '':'active')?>" href="
                        <?= $this->url('producer', ['action'=>'unknown']); ?>">
                        Все
                    </a>
                </span>    
                <input type="text" class="form-control" aria-label="..." name="q" value="<?= $q ?>">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="submit">Найти</button>
                </span>
            </div>    
        </div>  
    </div>
</form>
            <a href="#" id="username" data-type="text" data-placement="right" data-title="Enter username">superuser</a>
            <a href="#" id="producer" data-type="typeaheadjs" data-pk="1" data-url="/post" data-title="Производитель">Russia</a>

<table class="table table-striped">

   <tr>
        <th>ID</th>
        <th>Известный</th>
        <th>Неизвестный</th>
        <th>Действие</th>
    </tr>
    
    <?php foreach ($producer as $row): ?>
    <tr>
        <td><?= $this->escapeHtml($row->getId()); ?></td>
        <td>
                <?php if ($row->getProducer()): ?>    
                    <?= $this->escapeHtml($row->getProducer()->getName()); ?>
                <?php endif; ?>
            </a>
            <?php if ($row->getProducer()): ?>    
<!--                <a href="<?= $this->url('producer', ['action'=>'view', 'id'=>$row->getProducer()->getId()]); ?>">
                    <?= $this->escapeHtml($row->getProducer()->getName()); ?>
                </a> -->
            <?php endif; ?>
        </td>
        <td><?= $row->getName(); ?></td>        
        <td>
            <?php if ($row->getProducer()): ?>
            <?php else: ?>
                <a class="btn btn-info" href="<?= $this->url('producer', 
                        ['action'=>'from-unknown', 'id'=>$row->getId()], ['query' => ['page' => $page]]); ?>">
                    <span class="glyphicon glyphicon-pencil" ></span>Добавить
                </a>
            <?php endif; ?>
            <a class="btn btn-danger" href="<?= $this->url('producer',
                    ['action'=>'delete-unknown', 'id'=>$row->getId()], ['query' => ['page' => $page]]); ?>">
                <span class="glyphicon glyphicon-remove"></span> Удалить
            </a>
        </td>    
    </tr>
        
    <?php endforeach; ?>   
    
</table>
<?= $this->paginationControl($producer,
            'Sliding',
            'application/partial/paginator', 
            ['route' => array('route' => 'producer', 'action' => 'unknown', 'query' => $q)]); ?>

<script type="text/javascript">
    $(document).ready(function() {
        $.fn.editable.defaults.mode = 'popup';
        
        $('#username').editable();
        
        $(function(){
            $('#producer').editable({
                value: 'ru',
                typeahead: {
                    name: 'country',
                    local: [
                        {value: 'ru', tokens: ['Russia']}, 
                        {value: 'gb', tokens: ['Great Britain']}, 
                        {value: 'us', tokens: ['United States']}
                    ],
                    template: function(item) {
                        return item.tokens[0] + ' (' + item.value + ')'; 
                    } 
                }
            });
        });        
    });    
</script>